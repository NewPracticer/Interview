### 场景方案

#### 电商场景方案 
+ 电商场景特点
    1. CA 要求高，P也有要求
+ 减库存
   + 压力点
      1. 不希望每次减库存操作都写DB
      2. 不希望每次读取库存都通过DB
   + 方案( [服务无状态](https://www.redhat.com/zh/topics/cloud-native-apps/stateful-vs-stateless)，批量写入，最终一致性)
      1. 库存服务
      2. Redis(key/value)库存
      3. 库存变更记录（Worker）
      4. 更新库存DB 
+ 秒杀 
   + 特点
      1. 瞬时流量大
      2. 读多写少
      3. 实时性要求高
   + 难点
      1. 减少DB命中：缓存，缓冲
      2. 需要反欺诈 
      3. 需要削峰： MQ消息队列
      4. 缓存一致性的实现：例如预减库存，用户下单后保留一段时间，然后释放
+ 下单、支付
   + 难点
        + 订单表通常很大 —> 水平拆分
        + 订单需要支持的业务非常多
            1. 订单状态变化（状态机）需要的资源较多
            2. 订单表访问非常频繁
            3. 需要通知的业务方很多
   + 策略
       1. 缓冲
       2. 缓冲设计
       3. 最终一致性
   + 方案
       1. 下单
           1. Redis订单（userid/order）
               1. 订单状态机
                    1. DB
           1. 订单队列
               1. DB
+ 缓存
   1. 端缓存
   2. 代理缓存
   3. CDN
   4. 分布式缓存
+ 单元化技术
   1. 多活
      1. 两地三中心：生产、同城灾备、异地灾备。  
   2. 灾备的处理方案
      1. 降级
      2. 限流
      3. 切流量     
    
   
        